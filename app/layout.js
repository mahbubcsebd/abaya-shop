'use client';

import { Poppins } from 'next/font/google';
import { usePathname } from 'next/navigation';
import Script from 'next/script';
import { useEffect, useReducer } from 'react';
import { ToastContainer } from 'react-toastify';
import 'react-toastify/dist/ReactToastify.css';
import Footer from './components/Footer';
import Header from './components/Header';
import { ProductContext } from './context/cartContext';
import { ScrollProvider } from './context/scrollContext';
import './globals.css';
import { cartReducer, initialState } from './reducer/CartReducer';
import { SearchProvider } from './reducer/SearchContext';

const poppins = Poppins({
    weight: ['100', '200', '300', '400', '500', '600', '700', '800', '800'],
    style: ['normal', 'italic'],
    subsets: ['latin'],
});

// export const metadata = {
//   title: "Abaya Shop",
//   description: "Generated by create next app",
// };

export default function RootLayout({ children }) {
    const pathname = usePathname();

    const [state, dispatch] = useReducer(cartReducer, initialState);
    useEffect(() => {
        dispatch({
            type: 'SET_CART',
        });
    }, []);

    return (
        <html lang="en">
            {/* <GoogleTagManager gtmId="GTM-TJDRPB6Q" /> */}
            <Script
                id="google-tag-manager"
                dangerouslySetInnerHTML={{
                    __html: `
            ;(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TJDRPB6Q');
          `,
                }}
            />
            <noscript>
                <iframe
                    src="https://www.googletagmanager.com/ns.html?id=GTM-TJDRPB6Q"
                    height="0"
                    width="0"
                    style="display:none;visibility:hidden"
                ></iframe>
            </noscript>
            <body className={poppins.className}>
                <ProductContext.Provider value={{ state, dispatch }}>
                    <ScrollProvider>
                        <SearchProvider>
                            {pathname !== '/order-successfull' && <Header />}
                            {children}
                            {pathname !== '/order-successfull' && <Footer />}
                            <ToastContainer />
                        </SearchProvider>
                    </ScrollProvider>
                </ProductContext.Provider>
                <button
                    onClick={() =>
                        sendGTMEvent('event', 'add_to_cart', {
                            value: 'Button clicked working',
                        })
                    }
                >
                    Send Event Button
                </button>
            </body>
        </html>
    );
}
